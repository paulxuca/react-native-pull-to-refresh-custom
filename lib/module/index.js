import _extends from"@babel/runtime/helpers/extends";import _classCallCheck from"@babel/runtime/helpers/classCallCheck";import _createClass from"@babel/runtime/helpers/createClass";import _possibleConstructorReturn from"@babel/runtime/helpers/possibleConstructorReturn";import _getPrototypeOf from"@babel/runtime/helpers/getPrototypeOf";import _assertThisInitialized from"@babel/runtime/helpers/assertThisInitialized";import _inherits from"@babel/runtime/helpers/inherits";var _jsxFileName="/Users/paulxu/dev/react-native-pull-to-refresh-custom/src/index.tsx";import React,{Component}from'react';import{View,Animated,PanResponder}from'react-native';var styles={con:{flex:1,backgroundColor:'#fff'}};var PullToRefresh=function(_Component){_inherits(PullToRefresh,_Component);function PullToRefresh(props){var _this;_classCallCheck(this,PullToRefresh);_this=_possibleConstructorReturn(this,_getPrototypeOf(PullToRefresh).call(this,props));_this.containerTranslateY=0;_this.innerScrollTop=0;_this.headerRef=null;_this.containerTopChange=function(_ref){var value=_ref.value;_this.containerTranslateY=value;if(_this.headerRef){_this.headerRef.setProgress({pullDistance:value,percent:value/(_this.props.refreshTriggerHeight||_this.props.headerHeight)});}};_this.innerScrollCallback=function(event){_this.innerScrollTop=event.nativeEvent.contentOffset.y;};_this.state={containerTop:new Animated.Value(0)};_this.state.containerTop.addListener(_this.containerTopChange);_this.onMoveShouldSetResponder=_this.onMoveShouldSetResponder.bind(_assertThisInitialized(_this));_this.onResponderGrant=_this.onResponderGrant.bind(_assertThisInitialized(_this));_this.onResponderReject=_this.onResponderReject.bind(_assertThisInitialized(_this));_this.onPanResponderMove=_this.onPanResponderMove.bind(_assertThisInitialized(_this));_this.onPanResponderRelease=_this.onPanResponderRelease.bind(_assertThisInitialized(_this));_this.onPanResponderTerminate=_this.onPanResponderTerminate.bind(_assertThisInitialized(_this));_this._panResponder=PanResponder.create({onMoveShouldSetPanResponder:_this.onMoveShouldSetResponder,onPanResponderGrant:_this.onResponderGrant,onPanResponderReject:_this.onResponderReject,onPanResponderMove:_this.onPanResponderMove,onPanResponderRelease:_this.onPanResponderRelease,onPanResponderTerminationRequest:function onPanResponderTerminationRequest(evt,gestureState){return true;},onPanResponderTerminate:_this.onPanResponderTerminate});return _this;}_createClass(PullToRefresh,[{key:"onMoveShouldSetResponder",value:function onMoveShouldSetResponder(event,gestureState){if(this.props.refreshing){return false;}if(this.innerScrollTop<=this.props.topPullThreshold&&gestureState.dy>0){return true;}return false;}},{key:"onResponderGrant",value:function onResponderGrant(event,gestureState){}},{key:"onResponderReject",value:function onResponderReject(event,gestureState){}},{key:"onPanResponderMove",value:function onPanResponderMove(event,gestureState){var dy=Math.max(0,gestureState.dy);this.state.containerTop.setValue(dy);}},{key:"onPanResponderRelease",value:function onPanResponderRelease(event,gestureState){var threshold=this.props.refreshTriggerHeight||this.props.headerHeight;if(this.containerTranslateY>=threshold){this.props.onRefresh();}else{this._resetContainerPosition();}}},{key:"onPanResponderTerminate",value:function onPanResponderTerminate(event,gestureState){this._resetContainerPosition();}},{key:"_resetContainerPosition",value:function _resetContainerPosition(){Animated.timing(this.state.containerTop,{toValue:0,duration:250,useNativeDriver:true}).start();}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps,prevState){if(!prevProps.refreshing&&this.props.refreshing){var holdHeight=this.props.refreshingHoldHeight||this.props.headerHeight;Animated.timing(this.state.containerTop,{toValue:holdHeight,duration:150,useNativeDriver:true}).start();}else if(prevProps.refreshing&&!this.props.refreshing){Animated.timing(this.state.containerTop,{toValue:0,duration:250,useNativeDriver:true}).start();}}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.state.containerTop.removeAllListeners();}},{key:"renderHeader",value:function renderHeader(){var _this2=this;var style={position:'absolute',left:0,width:'100%',top:-this.props.headerHeight,transform:[{translateY:this.state.containerTop}]};var percent=Animated.divide(this.state.containerTop,this.props.refreshTriggerHeight||this.props.headerHeight);var Header=this.props.HeaderComponent;return React.createElement(Animated.View,{style:style,__source:{fileName:_jsxFileName,lineNumber:214}},React.createElement(Header,{ref:function ref(c){_this2.headerRef=c;},percentAnimatedValue:percent,pullDistance:this.containerTranslateY,percent:this.containerTranslateY/this.props.headerHeight,refreshing:this.props.refreshing,__source:{fileName:_jsxFileName,lineNumber:215}}));}},{key:"render",value:function render(){var child=React.cloneElement(this.props.children,{onScroll:this.innerScrollCallback,bounces:false,alwaysBounceVertical:false});return React.createElement(View,_extends({style:this.props.style},this._panResponder.panHandlers,{__source:{fileName:_jsxFileName,lineNumber:233}}),React.createElement(Animated.View,{style:[{flex:1,transform:[{translateY:this.state.containerTop}]}],__source:{fileName:_jsxFileName,lineNumber:237}},child),this.renderHeader());}}]);return PullToRefresh;}(Component);PullToRefresh.defaultProps={style:styles.con,refreshing:false,topPullThreshold:2};export{PullToRefresh as default};
//# sourceMappingURL=index.js.map