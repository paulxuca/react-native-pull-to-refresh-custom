var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _react=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _jsxFileName="/Users/paulxu/dev/react-native-pull-to-refresh-custom/src/index.tsx";var styles={con:{flex:1,backgroundColor:"#fff"}};var PullToRefresh=function(_Component){(0,_inherits2.default)(PullToRefresh,_Component);function PullToRefresh(props){var _this;(0,_classCallCheck2.default)(this,PullToRefresh);_this=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(PullToRefresh).call(this,props));_this.containerTranslateY=0;_this.innerScrollTop=0;_this.headerRef=null;_this.containerTopChange=function(_ref){var value=_ref.value;_this.containerTranslateY=value;if(_this.headerRef){_this.headerRef.setProgress({pullDistance:value,percent:value/(_this.props.refreshTriggerHeight||_this.props.headerHeight)});}};_this.innerScrollCallback=function(event){_this.innerScrollTop=event.nativeEvent.contentOffset.y;};_this.state={containerTop:new _reactNative.Animated.Value(0)};_this.state.containerTop.addListener(_this.containerTopChange);_this.onMoveShouldSetResponder=_this.onMoveShouldSetResponder.bind((0,_assertThisInitialized2.default)(_this));_this.onResponderGrant=_this.onResponderGrant.bind((0,_assertThisInitialized2.default)(_this));_this.onResponderReject=_this.onResponderReject.bind((0,_assertThisInitialized2.default)(_this));_this.onPanResponderMove=_this.onPanResponderMove.bind((0,_assertThisInitialized2.default)(_this));_this.onPanResponderRelease=_this.onPanResponderRelease.bind((0,_assertThisInitialized2.default)(_this));_this.onPanResponderTerminate=_this.onPanResponderTerminate.bind((0,_assertThisInitialized2.default)(_this));_this._panResponder=_reactNative.PanResponder.create({onMoveShouldSetPanResponder:_this.onMoveShouldSetResponder,onPanResponderGrant:_this.onResponderGrant,onPanResponderReject:_this.onResponderReject,onPanResponderMove:_this.onPanResponderMove,onPanResponderRelease:_this.onPanResponderRelease,onPanResponderTerminationRequest:function onPanResponderTerminationRequest(evt,gestureState){return true;},onPanResponderTerminate:_this.onPanResponderTerminate});return _this;}(0,_createClass2.default)(PullToRefresh,[{key:"onMoveShouldSetResponder",value:function onMoveShouldSetResponder(event,gestureState){if(this.props.refreshing){return false;}if(this.innerScrollTop<=this.props.topPullThreshold&&gestureState.dy>20){return true;}return false;}},{key:"onResponderGrant",value:function onResponderGrant(event,gestureState){}},{key:"onResponderReject",value:function onResponderReject(event,gestureState){}},{key:"onPanResponderMove",value:function onPanResponderMove(event,gestureState){var dy=Math.max(0,gestureState.dy);this.state.containerTop.setValue(dy);}},{key:"onPanResponderRelease",value:function onPanResponderRelease(event,gestureState){var threshold=this.props.refreshTriggerHeight||this.props.headerHeight;if(this.containerTranslateY>=threshold){this.props.onRefresh();}else{this._resetContainerPosition();}}},{key:"onPanResponderTerminate",value:function onPanResponderTerminate(event,gestureState){this._resetContainerPosition();}},{key:"_resetContainerPosition",value:function _resetContainerPosition(){_reactNative.Animated.timing(this.state.containerTop,{toValue:0,duration:250,useNativeDriver:true}).start();}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps,prevState){if(!prevProps.refreshing&&this.props.refreshing){var holdHeight=this.props.refreshingHoldHeight||this.props.headerHeight;_reactNative.Animated.timing(this.state.containerTop,{toValue:holdHeight,duration:150,useNativeDriver:true}).start();}else if(prevProps.refreshing&&!this.props.refreshing){_reactNative.Animated.timing(this.state.containerTop,{toValue:0,duration:250,useNativeDriver:true}).start();}}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.state.containerTop.removeAllListeners();}},{key:"renderHeader",value:function renderHeader(){var _this2=this;var style={position:"absolute",left:0,width:"100%",top:-this.props.headerHeight,transform:[{translateY:this.state.containerTop}]};var percent=_reactNative.Animated.divide(this.state.containerTop,this.props.refreshTriggerHeight||this.props.headerHeight);var Header=this.props.HeaderComponent;return _react.default.createElement(_reactNative.Animated.View,{style:style,__source:{fileName:_jsxFileName,lineNumber:239}},_react.default.createElement(Header,{ref:function ref(c){_this2.headerRef=c;},percentAnimatedValue:percent,pullDistance:this.containerTranslateY,percent:this.containerTranslateY/this.props.headerHeight,refreshing:this.props.refreshing,__source:{fileName:_jsxFileName,lineNumber:240}}));}},{key:"render",value:function render(){var child=_react.default.cloneElement(this.props.children,{onScroll:this.innerScrollCallback,bounces:false,alwaysBounceVertical:false});return _react.default.createElement(_reactNative.View,(0,_extends2.default)({style:this.props.style},this._panResponder.panHandlers,{__source:{fileName:_jsxFileName,lineNumber:260}}),_react.default.createElement(_reactNative.Animated.View,{style:[{flex:1,transform:[{translateY:this.state.containerTop}]}],__source:{fileName:_jsxFileName,lineNumber:261}},child),this.renderHeader());}}]);return PullToRefresh;}(_react.Component);exports.default=PullToRefresh;PullToRefresh.defaultProps={style:styles.con,refreshing:false,topPullThreshold:2};
//# sourceMappingURL=index.js.map